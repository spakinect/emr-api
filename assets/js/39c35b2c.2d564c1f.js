"use strict";(self.webpackChunkemr_api=self.webpackChunkemr_api||[]).push([[782],{8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>a});var r=t(6540);const i={},s=r.createContext(i);function d(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(s.Provider,{value:n},e.children)}},8818:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"webhooks","title":"Webhook Events","description":"Spakinect can send webhook notifications to your EMR system when specific events occur. This allows you to receive real-time updates about visits and treatments without polling the API.","source":"@site/docs/webhooks.md","sourceDirName":".","slug":"/webhooks","permalink":"/emr-api/webhooks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"webhooks","title":"Webhook Events","sidebar_position":2},"sidebar":"tutorialSidebar"}');var i=t(4848),s=t(8453);const d={id:"webhooks",title:"Webhook Events",sidebar_position:2},a="Webhook Events",o={},l=[{value:"Webhook Security",id:"webhook-security",level:2},{value:"Signature Verification",id:"signature-verification",level:3},{value:"How to Verify the Signature",id:"how-to-verify-the-signature",level:4},{value:"How to Get Payload, Signature, and API Key",id:"how-to-get-payload-signature-and-api-key",level:4},{value:"Signature Verification Function",id:"signature-verification-function",level:4},{value:"Supported Events",id:"supported-events",level:2},{value:"1. Visit Completed (<code>visit.completed</code>)",id:"1-visit-completed-visitcompleted",level:3},{value:"Payload Structure",id:"payload-structure",level:4},{value:"Payload Fields",id:"payload-fields",level:4}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"webhook-events",children:"Webhook Events"})}),"\n",(0,i.jsx)(n.p,{children:"Spakinect can send webhook notifications to your EMR system when specific events occur. This allows you to receive real-time updates about visits and treatments without polling the API."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," To receive webhook events, a location must be subscribed to the EMR using the Location subscription endpoint (",(0,i.jsx)(n.code,{children:"POST /subscriptions"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"webhook-security",children:"Webhook Security"}),"\n",(0,i.jsx)(n.p,{children:"All webhook requests from Spakinect include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Content-Type"}),": ",(0,i.jsx)(n.code,{children:"application/json"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"User-Agent"}),": ",(0,i.jsx)(n.code,{children:"Spakinect-Webhook/1.0"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"X-Signature"}),": HMAC-SHA256 signature (if API key is configured)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"signature-verification",children:"Signature Verification"}),"\n",(0,i.jsxs)(n.p,{children:["Spakinect uses ",(0,i.jsx)(n.strong,{children:"HMAC-SHA256"})," to sign webhook payloads. The signature is sent in the ",(0,i.jsx)(n.code,{children:"X-Signature"})," header and is generated using your EMR's API key as the secret."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important"}),": Always verify the webhook signature to ensure the request is authentic and hasn't been tampered with."]}),"\n",(0,i.jsx)(n.h4,{id:"how-to-verify-the-signature",children:"How to Verify the Signature"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Extract the ",(0,i.jsx)(n.code,{children:"X-Signature"})," header from the incoming request"]}),"\n",(0,i.jsxs)(n.li,{children:["Generate your own signature using:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Algorithm"}),": HMAC-SHA256"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secret"}),": Your EMR's API key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message"}),": The raw JSON payload body (as a string)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Compare your generated signature with the ",(0,i.jsx)(n.code,{children:"X-Signature"})," header"]}),"\n",(0,i.jsx)(n.li,{children:"If they match, the webhook is authentic"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"how-to-get-payload-signature-and-api-key",children:"How to Get Payload, Signature, and API Key"}),"\n",(0,i.jsx)(n.p,{children:"In your webhook handler, you need to extract three pieces of information:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Payload"}),": The raw JSON string from the response body"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Signature"}),": The ",(0,i.jsx)(n.code,{children:"X-Signature"})," header value"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Key"}),": The API key provided by Spakinect when you registered your EMR"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Important Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The payload must be the ",(0,i.jsx)(n.strong,{children:"raw JSON string"})," (not parsed object) for signature verification"]}),"\n",(0,i.jsxs)(n.li,{children:["The signature is sent in the ",(0,i.jsx)(n.code,{children:"X-Signature"})," HTTP header"]}),"\n",(0,i.jsx)(n.li,{children:"The API key is the same key provided by Spakinect when you registered your EMR system"}),"\n",(0,i.jsx)(n.li,{children:"Store your API key securely (environment variables, secure config, or database)"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"signature-verification-function",children:"Signature Verification Function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const crypto = require('crypto');\r\n \r\nfunction verifySignature(payload, signature, apiKey) {\r\n  if (!apiKey || !signature) {\r\n    return false;\r\n  }\r\n\r\n  // Convert payload to JSON string if it's an object\r\n  const payloadString = typeof payload === 'string' \r\n    ? payload \r\n    : JSON.stringify(payload);\r\n  \r\n  // Generate expected signature\r\n  const expectedSignature = crypto\r\n    .createHmac('sha256', apiKey)\r\n    .update(payloadString)\r\n    .digest('hex');\r\n  \r\n  // Use constant-time comparison to prevent timing attacks\r\n  try {\r\n    return crypto.timingSafeEqual(\r\n      Buffer.from(signature, 'hex'),\r\n      Buffer.from(expectedSignature, 'hex')\r\n    );\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Signature verification is ",(0,i.jsx)(n.strong,{children:"strongly recommended"})," for production environments."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"supported-events",children:"Supported Events"}),"\n",(0,i.jsxs)(n.h3,{id:"1-visit-completed-visitcompleted",children:["1. Visit Completed (",(0,i.jsx)(n.code,{children:"visit.completed"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Triggered when a Good Faith Exam (GFE) visit is completed and all treatment decisions have been made."}),"\n",(0,i.jsx)(n.h4,{id:"payload-structure",children:"Payload Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "event": "visit.completed",\r\n  "timestamp": 1714675200000,\r\n  "success": true,\r\n  "data": {\r\n    "location_id": "loc_12345",\r\n    "gfe_id": "gfe_abc123xyz789",\r\n    "status": "Completed",\r\n    "pdf_link": "https://example-cdn.com/gfe/gfe_abc123xyz789.pdf",\r\n    "requested_treatments": [\r\n      "Botox Injection",\r\n      "Dermal Filler"\r\n    ],\r\n    "approved_treatments": [\r\n      "Botox Injection"\r\n    ],\r\n    "conditionally_approved_treatments": [\r\n      "Dermal Filler"\r\n    ],\r\n    "deferred_treatments": [],\r\n    "patient_details": {\r\n      "name": "Jane Smith",\r\n      "first_name": "Jane",\r\n      "last_name": "Smith",\r\n      "email": "jane.smith@example.com"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"payload-fields",children:"Payload Fields"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"event"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Always ",(0,i.jsx)(n.code,{children:'"visit.completed"'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timestamp"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"Unix timestamp in milliseconds when the event occurred"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"success"})}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"Indicates if the data retrieval was successful"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.location_id"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"The ID of the location where the visit took place"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.gfe_id"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Unique identifier for the GFE visit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.status"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Visit status (always ",(0,i.jsx)(n.code,{children:'"Completed"'})," for this event)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.pdf_link"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"URL to download the GFE PDF (if available)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.requested_treatments"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"List of treatment names originally requested"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.approved_treatments"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"List of treatment names that were approved"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.conditionally_approved_treatments"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"List of treatment names with conditional approval"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.deferred_treatments"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"List of treatment names that were deferred"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.patient_details"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsx)(n.td,{children:"Patient information"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.patient_details.name"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Patient's full name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.patient_details.first_name"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Patient's first name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.patient_details.last_name"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Patient's last name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"data.patient_details.email"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Patient's email address"})]})]})]}),"\n",(0,i.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);