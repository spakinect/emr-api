post:
  summary: Register Webhook URL
  description: |
    Registers or updates the webhook URL for the authenticated EMR.

    **Note:** To receive webhook events, a location must be subscribed to the EMR
    using the Location subscription endpoint (`POST /subscriptions`).

    When a GFE is completed, Spakinect will send a POST request to the registered
    URL with the payload described in `VisitCompletedWebhook`.

    - Event: `visit.completed`
    - Headers: `Content-Type: application/json`, `User-Agent: Spakinect-Webhook/1.0`,
      and if configured `X-Webhook-Secret: <secret>`.
    - Schema: `#/components/schemas/VisitCompletedWebhook`
  operationId: registerWebhook
  tags:
    - Webhooks
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: "../emr-openapi.yaml#/components/schemas/WebhookRegistrationRequest"
        examples:
          webhook_registration:
            summary: Register webhook URL
            value:
              url: https://example.com/webhooks/emr-callback
  responses:
    "200":
      description: Webhook URL registered successfully
      content:
        application/json:
          schema:
            $ref: "../emr-openapi.yaml#/components/schemas/WebhookRegistrationResponse"
          examples:
            success:
              summary: Successful webhook registration
              value:
                success: true
                message: Webhook URL updated successfully
    "400":
      $ref: "../emr-openapi.yaml#/components/responses/BadRequest"
    "401":
      $ref: "../emr-openapi.yaml#/components/responses/Unauthorized"
    "403":
      $ref: "../emr-openapi.yaml#/components/responses/Forbidden"
    "404":
      $ref: "../emr-openapi.yaml#/components/responses/NotFound"
    "500":
      $ref: "../emr-openapi.yaml#/components/responses/InternalServerError"
